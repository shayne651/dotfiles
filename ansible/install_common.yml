- name: Installing commonly used
  block:

# INSTALLING docker
  - name: Install docker on mac
    when: ansible_facts['os_family'] == "Darwin"
    homebrew:
      package: docker
      state: present

  - name: Install docker on ubuntu
    when: ansible_facts['os_family'] == "Debian"
    become: yes
    block:
      - name: Update apt package index
        apt:
          update_cache: yes

      - name: Install dependencies
        apt:
          name:
            - ca-certificates
            - curl
          state: present

      - name: Create apt keyrings directory
        file:
          path: /etc/apt/keyrings
          state: directory
          mode: '0755'

      - name: Add Docker GPG key
        get_url:
          url: https://download.docker.com/linux/ubuntu/gpg
          dest: /etc/apt/keyrings/docker.asc
          mode: '0644'

      - name: Add Docker repository
        shell: |
          echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}") stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null
        args:
          executable: /bin/bash

      - name: Update apt package index after adding repository
        apt:
          update_cache: yes

      - name: Install Docker packages
        apt:
          name:
            - docker-ce
            - docker-ce-cli
            - containerd.io
            - docker-buildx-plugin
            - docker-compose-plugin
          state: present

# INSTALLING go
  - name: Install go on mac
    when: ansible_facts['os_family'] == "Darwin"
    homebrew:
      package: go
      state: present

  - name: Install go on ubuntu
    when: ansible_facts['os_family'] == "Debian"
    become: yes
    snap:
      name: go
      classic: yes

# INSTALLING bruno
  - name: Install bruno on mac
    when: ansible_facts['os_family'] == "Darwin"
    homebrew_cask:
      package: bruno
      state: present

# INSTALLING ghosty (mac only)
  - name: Install ghostty on mac
    when: ansible_facts['os_family'] == "Darwin"
    homebrew_cask:
      package: ghostty
      state: present

# INSTALLING gitui
  - name: Install gitui on mac
    when: ansible_facts['os_family'] == "Darwin"
    homebrew:
      package: gitui
      state: present

  - name: Install gitui on ubuntu
    when: ansible_facts['os_family'] == "Debian"
    become: yes
    shell: |
      curl -s curl -s https://api.github.com/repos/extrawurst/gitui/releases/latest | grep -wo "https.*linux.*gz" | wget -qi -
      tar xzvf gitui-linux-musl.tar.gz
      rm gitui-linux-musl.tar.gz
      sudo chmod +x gitui
      sudo mv gitui /usr/local/bin
